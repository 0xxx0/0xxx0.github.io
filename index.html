<!doctype html>
<html><head id=HEAD><meta 
charset='utf-8'    
name="viewport"             
content="user-scalable=no,user-scalable=0"/><title>
    TITLE                       </title>
<style id='root'>
  :root{--SYSFONTS:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', Helvetica, Arial, monospace;
--C0:0,0,0;
--C1:51,51,51;
--C2:102,102,102;
--C3:154,154,154;
--C4:205,205,205;
--C5:255,255,255;
--C_0:#000;--C_1:#333;--C_2:#666;--C_3:#AAA;--C_4:#CCC;--C_5:#FFF;
--Ca0:#330000;--Ca1:#660000;--Ca2:#880000;--Ca3:#AA0000;--Ca4:#CC0000;--Ca5:#FF0000;
--Cb0:#000033;--Cb1:#000066;--Cb2:#000088;--Cb3:#0000AA;--Cb4:#0000CC;--Cb5:#0000FF;
--Cc0:rgba(var(--C0),0.3);
--Cc1:rgba(var(--C1),0.3);--Cc2:rgba(var(--C2),0.3);--Cc3:rgba(var(--C3),0.3);--Cc4:rgba(var(--C4),0.3);--Cc5:rgba(var(--C5),0.3);
--TRANSLUSCENT: rgba(128,128,128,.3) ;--TRANSLUSCENT2: rgba(0,0,0,.3) ;--TRANSLUSCENT3: rgba(255,255,255,.3)
;--REVEALS: inset 0 0 calc(.2*var(--VW)) 1em var(--Cc2)
;--OUTLINE: none;/*solid .3px *//*var(--Ca3)*/ ;
/* ------.-----–---.---- ---–.---------.-–------- ----–----.-------–-.---- ----.–----- [NUMBERS] */
--SCALE:var(--PHI)/*1.5*/;--MIN2nd:1.067;--MAJ2nd:1.125;--MIN3rd:1.2/*6/5*/ ;--MAJ3rd:1.25;--PER4th:1.333;--AUGM4th:1.414;--PER5th:1.5;--PHI:1.618/* CaSCHEME~>lum/5*/; --NEG:-1;--THIRD:calc(1/3);--HALF:0.5;
--DEC:0.1; --CEN:0.01;
/* ------.-----–---.---- ---–.---------.-–------- ----–----.-------–-.---- ----.–------- [SIZES] */
--FONTSIZE:16px; --EM:1em; --VW:100vw ;--VH:100vh ;--PERSP:32em; --PERSPORIGIN:center ; --SVGW:100% ;--SVGH:100% ;--STROKE:.3 ; 
--S00: 0.01em; --S01:0.1em;
/*--SIZE1:calc(var(--EM)*var(--SCALE)); */
/*;--MARQUEE: 5s linear infinite*/
--PECENT:1%;
; --DEBUG:0.5px solid var(--TRANSLUSCENT); 
/* ------.-----–---.---- ---–.---------.-–------- ----–----.-------–-.---- ----.–--------.--- [] */

}                 
</style>
<!-- <link rel="stylesheet" type="text/css" href="root.css"/> -->
<style id=core>
  /* ------.-----–---.---- ---–.---------.-–------- ----–----.-------–-.---- ----.–-- [BOX-SIZING] */
*,*:before,*:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;text-rendering: optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-kerning:auto;}
/* ------.-----–---.---- ---–.---------.-–------- ----–----.-------–-.---- --- [LOBOTOMIZED OWL] */
p{text-align: justify;}p+p{margin-top: 0; text-indent: 2em;}*+*{margin/*-top*/:var(--S01)}.tight>*{margin-top:var(--S01)} .margins-off>*{margin-top: 0;}
/* ------.-----–---.---- ---–.---------.-–------- ----–----.-------–-.---- ----.–-------- [MAIN] */
body{font-family:var(--SYSFONTS);font-size:var(--FONTSIZE); background-color:var(--C_0); color:var(--C_2); padding-top:0; overflow:hidden;  /*margin-bottom:0;*/ height:100vh;}
section *{height:auto;width:auto; }
/*::-webkit-scrollbar {width:0.1em; height:0.1em;}*/
/*::-webkit-scrollbar-track {height:1em; width:1em;}*/
/*::-webkit-scrollbar {width:.5em; height:.5em;}*/
/*::-webkit-scrollbar-track {box-shadow: inset 0 0 3px var(--C_5); }*/

</style>

<style id=cube>
  .view{--W:100vw
     ;--H:100vh
     ;--PERSP:32em
     ;--C32:rgba(128,128,128,.3)
     ;--TRANSITION:transform 300ms;
     ;--OUTLINE:3px solid black;
     ;position:absolute
     ;transform-origin:calc(-0.5*var(--W)) calc(-0.5*var(--H)) 0
     ;overflow:hidden
     ;perspective:var(--PERSP)
     ;left:0;top:0
     ;}

#BODY{transition:var(--TRANSITION);}

.room{height:var(--H)
     ;width:var(--W)
     ;margin:0
     ;transform-style:preserve-3d
     ;transition:var(--TRANSITION)
     ;}
.room.face{position:absolute
       /*;outline:var(--OUTLINE)*/
       ;box-shadow: var(--REVEALS)
       ;height:100%;width:100%
       ;}
.room.f{transform:translateZ(calc(-0.5*var(--W)))}
.room.o{transform:rotateX(0deg)translateZ(calc(0.5*var(--W)))}
.room.l{transform:rotateY(90deg)translateZ(calc(-0.5*var(--W)))}
.room.r{transform:rotateY(-90deg)translateZ(calc(-0.5*var(--W)))}
.room.w{transform:rotateX(90deg)rotateZ(0deg)translateZ(calc(0.5*var(--W)))scaleY(-1)
       ;height:var(--W);}
.room.e{transform:rotateX(90deg)translateZ(calc(0.5*var(--W)))translateZ(calc(-1*var(--H)))
       ;height:var(--W);}
.room{transform:translateZ(calc(-0.5*var(--W)))}
</style>


<style id=interface>
  :focus{outline:none;}
input {font-size: var(--EM); background-color: transparent; border:none; color:var(--Cc3); width:3em;  opacity:.5;}
input:focus {height:var(--EM); background-color: var(--Cc3);color:var(--C_5);}

#MIND{position:absolute;height:100%;width:100%;left:0;top:0;z-index:1;}
#WILL{z-index:1;width:auto;height:auto;}
#ENTRY{position:absolute; height:calc(var(--TETRA)*var(--EM));width:auto;z-index:2;}
#ENTRY *{margin:calc(var(--HALF)*var(--EM));display:block;}
#INPUT {position:relative;height:2em; width:auto; opacity:.5; outline:1px solid var(--Cc3);}
#OUT{bottom:-115%;width:calc(0.5*var(--CW));
  position:relative; 
  height:2em;
  width:auto;
  overflow-y:hidden;}
#IN{width:calc(0.5*var(--CW));
  position:relative; 
  height:2em;
  width:auto;
}
#OUT *,#IN *{display:inline-block;margin:0;}

#OUT>*:focus >*,#OUT>*:hover >*,#IN>*:focus >*,#IN>*:hover >*, #sider>*:focus >*, #sider>*:hover >*, #sidel>*:focus >*, #sidel>*:hover >*{
  /*overflow:visible;*/
  position:relative;
  height:4em;width:4em;
  /*transform:scale3d(2,2,1);*/
  box-shadow:  0 0 3em var(--C_3);
  opacity:.5;
  z-index:3;}
/*#keyring:hover,#keyring:focus {box-shadow:  0 0 3em var(--C_3);} */
/*#keyring:hover >*,#keyring:focus >* { transform:scale3d(1.5,1.5,1);}*/
#keyring{  
  height:8em;width:8em;
  position:absolute;
  top:0%;
  right:100%;
  /*left:-100%;*/
  /*width:100%;*/
  /*overflow:hidden;*/
}
#STACK{display:inline;height:2em;overflow-x:scroll;}
#keyring *{display:inline;margin:0;}


.icon { height: 2em; width:2em; 
  outline:1px solid var(--Cc3);;
  /*background-color:var(--Cc3);*/
  position:relative;
  overflow:hidden;
  opacity:1;}
.active{box-shadow: inset 0 0 1em var(--C_3);color:var(--Ca5);}
</style>
<style id=utility>
  .reset-all-styles{all:initial;}
.X{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}
.hidden{display:none;}
.invisible{visibility:hidden;}
.ref{position: relative; }.refcard{position:relative;visibility:hidden;left:100%;top:10%;width:100%;}.ref:hover{overflow:visible;}.ref:hover>.refcard{visibility: visible;}
.nopoint{pointer-events:none !important;}.nopoint>*{pointer-events:auto !important;;}
/*.pointed{pointer-events:auto;}*/
.hlbg{background:var(--Cc5);}
.untransform{transform:none !important;}

.sunroof{background:linear-gradient(to bottom, #000066 10%,#1e528e 20%, #880000 50%, #e9ce5d 100%);}

[data-ref] {
  display: inline-block;/*bug fix*/
  position: relative;
  /*text-decoration: none;*/
  /*font-size:calc(var(--EM)*var(--HALF));*/
}
[data-ref]:after {
  content: attr(data-ref);
  position: absolute;
  /*bottom: 275%;*/
  float:left;
  right: 0%;
  background: var(--C_0);
  /*padding:1em;*/
  outline:1px solid var(--C_5);
  color: var(--C_5);
  white-space: pre-wrap;
  opacity: 0;
  z-index: 1;
}
[data-ref]:hover:after,[data-ref]:focus:after {bottom: 50%; }
[data-ref]:hover:after,[data-ref]:focus:after,[data-ref]:hover:before,[data-ref]:focus:before {opacity: 1; }


/*#STACK{overflow:scroll;height:2em;}*/
</style>

</head>                                    <body
id=BODY                                            >
												   <section 
id=MIND class=''                                   ><span
id=STACK class='X'                                 ></span><form 
id=WILL class='X'                                  ><div 
id=ENTRY class=''                                  ><div 
id=OUT  class=''                                   ></div><input
id=INPUT type="text" class='' spellcheck='false'  /><div
id=IN class=''                                     ></div></div></form>
<canvas id=SOUL class='X hidden'                   ></canvas>
												   </section>
<div class=view>
	<div class=room>
		<div class='room face f'></div>
		<div class='room face l'></div>
		<div class='room face o'></div>
		<div class='room face w'></div>
		<div class='room face e'></div>
		<div class='room face r'></div>
	</div>
</div>
<script id='#'>
world=window,yes=true,no=false,duh=undefined
let AudioContext = world.AudioContext||world.webkitAudioContext||false

SENSES=
[['ac',"new AudioContext"]
,['utter',"new SpeechSynthesisUtterance"]
,['cv',"SOUL.getContext('2d')"]
] 
PRELUDE=
[['within',"o=>k=>o[k]"]
,['wherewithin',"o=>k=>(a,b)=>o[k](a,b)"]
,['protocall',"o=>m=>(...f)=>g=> o['prototype'][m]['call'](g,...f)"]
,['properkeys',"x=>within(Object)('getOwnPropertyNames')(x)"]
,['protokeys',"x=>properkeys(within(x)('prototype'))"]
,['know_by',"(name,who_knows=this)=>thing=>who_knows[name]=thing"]
,['release',"(where={})=>f=>xs=>xs.reduce((a,x)=>(know_by(x,a)(f(x)),a),where)"]
,['funpack',"(pack,where=this)=> pack.map(fun=>know_by(fun[0],fun[2]||where)(eval(fun[1])))"]
,['BASICOPERATORS',`({add:b=>a=>a+b,sub:b=>a=>a-b,mul:b=>a=>a*b,div:b=>a=>a/b,pow:b=>a=>a**b,cyc:b=>a=>a%b,eq:b=>a=>a===b,ne:b=>a=>a!==b,gt:b=>a=>a>b,lt:b=>a=>a<b,lte:b=>a=>a<=b,gte:b=>a=>a>=b,or:b=>a=>a||b,and:b=>a=>a&&b,xor:b=>a=>(a&&!b)||(!a&&b),not:a=>!a,fort:a=>!!a,decr:(a,b=1)=>a-=b,incr:(a,b=1)=>a+=b,dec1:a=>a--,inc1:a=>a++,AND:b=>a=>a&b,OR:b=>a=>a|b,XOR:b=>a=>a^b,NOT:a=>~a,SHIFTL:b=>a=>a<<b,SHIFTR:b=>a=>a>>b,SHIFTR0:b=>a=>a>>>b,ife:a=>b=>a?a:b,ift:p=>f=>p?f:{},ifte:p=>f=>g=>p?f:g})`]
]/*within wherewithin protocall proprekeys protokeys know_by release funpack BASICOPERATORS*/
.map(fun=>world[fun[0]]=eval(fun[1]))
FREEDOOM= /*  */
[['captive',"(X,F,g)=>({X,F,Ks:typeof g==='function'?g(X):g})"]
,['RELEASE',"({X,F,Ks})=>release(where) (F(X)) (Ks)"]
,['RELEASE_THE',"(captives,where={})=> captives.reduce( (_,{X,F,Ks})=>release(where) (F(X)) (Ks))"]
]; [SENSES, PRELUDE, FREEDOOM].map(funs=>funpack(funs))
KRAKEN=
[[[Element,Node,Number,String,RegExp,Array],[protocall,protokeys]] 
,[[document],[wherewithin, protokeys(Document).filter(s=>s.match(/(^get|create|element|query|url)/gi))]]//TODO: filterdox   
,[[ac],  [wherewithin,  protokeys(/*BaseAudioContext*/AudioContext)] ]
,[[utter], [wherewithin, protokeys(SpeechSynthesisUtterance)]]
,[[speechSynthesis], [within, ['pause','resume','cancel', 'speaking','pending','paused', 'onvoiceschanged']]]
,[[cv],[wherewithin,properkeys(CanvasRenderingContext2D.prototype).filter(s=>!s.match(/(fill|filter)/gi))] ]
,[[Object,Date,Math,BASICOPERATORS],[within,properkeys]]
].reduce((a,c,i,o)=>a.concat(o[i][0].map(x=>[x,...o[i][1]])),[])
.map(captives=>captive(...captives))
RELEASE_THE(KRAKEN,/*!!End the*/world)
/*-================================================----*/
</script>
<script id='CORE'>
LOGIC={}
NOTES={}
DEMOS={}
CONF={}
  CORE=
  [['TYPES',"({PRIMITIVES:'array,string,object,regexp,number,function,text,'})",CONF]
// TYPES
  ,['type',"(x)=>({}).toString.call(x).slice(8,-1).toLowerCase()"]
  ,['ist',"release({})(b=>a=>eq(b)(type(a)))(split(',')(CONF.TYPES.PRIMITIVES))"]

// NUMERICAL
  ,['precisely', "x=>(y,sigfig)=> Number(sigfig?toPrecision(x)(y):toFixed(x)(y))"]
  // -- CARDINAITY
  ,['size',"x=>LOGIC.size[type(x)](x)"]
  ,['size',"({array:x=> x.length,string: x=> new Blob([x.replace(/./gu,'.')]).size,object: x=> x.size||x.length||Object.keys(x).length})",LOGIC]

// ASSIGNMENT
  ,['config',"o=>(...defaults)=> assign({},o,reverse()(...defaults),o)"]
  ,['deepFlatten',"f=a=>a.map?[].concat(...a.map(f)):a"]
  ,['fillar',"(n,i=0)=>slice(i,n)([...Array(n).keys()])"]
  ,['twith',"(f=((a,b)=>a.concat(b)),seed=[])=>(...a)=> map((_,i)=>reduce(f,seed)(map(y=>y[i])(a)))(a[0])"]
  ,['flatten',"(xs,d=1)=> d!=1?xs.reduce((a,c)=> a.concat(Array.isArray(c)?flatten(c,d-1):c),[]):xs.reduce((a,c)=>a.concat(c),[])"]
  ,['uniq',"arr => [...new Set(arr)]"]

// FUNCTIONAL
  ,['last',"xs=>slice(-1)(xs)"]
  ,['flip',"f=>a=>b=>f(b)(a)"]
  ,['head',"([x])=>x"]
  ,['tail',"([,...xs])=>xs"]
  // -- CURRYING
  ,['carry',"(f,d=f.length,...as)=> d<=as.length?f(...as):carry.bind(null,f,d,...as)"]
  ,['uncarry',"(f,d=1)=>(...as)=> as.slice(0,d).reduce((x,y)=>x(y),f)"]
  // ,['fold',"f=>acc=>xs=> xs.length===0?acc:fold(f,f(acc,head(xs)),tail(xs))"] // BROKEN?
  ,['unfold',"f=>seed=>(g=(f=>seed=>acc=>(res=f(seed),res?g(f)(res[1])(acc.concat([res[0]])):acc)),g(f)(seed)([]))"]
  ,['clamp',"([a,z]=[],f=lte,g=gte)=>x=> ifte(f(a)(x))(a)(ifte(g(z)(x))(z)(x))"]
  // -- COMPOSITION
  ,['flow',"(...paths)=> reduce ((left,right)=> (...as)=> right(left(...as))) (paths)"]
  ,['wolf',"(...paths)=> reduce ((left,right)=> (...as)=> left(right(...as))) (paths)"]

  ,['affix',"(l,r=l,i=[])=>(...xs)=>  i.concat(l,xs,r)"] // STRINGS
// !!!! MOVE TO STRING MANIPULATION, SEARCHING
  // ,['getWordAt',"(str,pos,left=str.slice(0,pos+1).search(/\\S+$/),right=str.slice(pos).search(/\\s/))=> right > 0 ? str.slice(left,right+pos) : str.slice(left)"]
  // ,['fuzzs',"(s,l,i=t=>t.indexOf(s))=>l.filter(t=>~i(t)).sort((t,u)=>i(t)-i(u))"]
  ]

</script>
<script id='HS'>
HS=
  [['H',`({a:{href:'#'},svg:{viewBox:'-16 -16 32 32'},pattern:{viewBox:'0 0 32 32',width:'5%',height:'5%',patternUnits:'userSpaceOnUse'},circle:{cx:0,cy:0,r:0.1},rect:{x:0,y:0,width:1,height:1},symbol:{viewBox:'-4 -4 8 8'},marker:{viewBox:'0 0 32 32',refX:0, refY:0,markerWidth:10,markerHeight:10,orient:'auto'},preconf:{SECTOGRAPH:{style:"stroke:var(--Cb5);stroke-width:.1;fill:var(--TRANSLUSCENT);opacity:1;"}}})`,CONF]
  ,['TYPES',"({html:'a,b,i,br,head,body,canvas,button,section,div,input,script,style,form,label,code,date,pre,img,span,h1,h2,h3,h4,h5,h6,p,iframe,textarea,summary,details,li,ul,ol,template,anchor,unknown'})",CONF]
  ,['H',"TAG=>(...ELS)=> [ TAG, config (ist.object(ELS[0]) ? shift()(ELS):{}) (ife(CONF['H'][TAG]) ({})) , ...ELS ]"]
  ,['h',"release(h={})(a=>H(a))((split(',')(CONF.TYPES.html)))"]
  

  // !!! MOVE TO SVG
  // ,['TYPES',"({svg:'foreignObject,image,svg,circle,ellipse,marker,line,path,rect,use,symbol,text,tspan,textPath,polyline,polygon,g,defs,pattern,linearGradient,title,desc'})",CONF]
  // ,['',"release(h)(a=>H(a))((split(',')(CONF.TYPES.svg)))"]
  ]
</script>
<script id='TEMPLE'>
//DEPENDENCY TESTS 
TEMPLE=
  [['NS','({html:"http://www.w3.org/1999/xhtml",svg:"http://www.w3.org/2000/svg"})',CONF]
  ,['tat',"({string:a=>el=> el.getAttribute(a),object:a=>el=> (map(e=>(el.setAttribute(e[0],(e[1]))))(entries(a)),el)})",LOGIC],['tat',"el=>key=> LOGIC.tat[type(key)](key)(el)"]
  ,['tml',"({ifSVG:x=> includes(x)(CONF.TYPES.svg.split(/\\W/)) ? CONF.NS.svg : CONF.NS.html ,array: x=>el=> appendChild(tml(x))(el) ,string: x=>el=> appendChild(createTextNode(x))(el) ,object: x=>el=> tat(el)(x)})",LOGIC],['tml',"(ml,el=createElementNS(LOGIC.tml.ifSVG(ml[0]),ml[0]))=>(forEach(node=>LOGIC.tml[type(node)](node)(el)) (slice(1)(ml)), el)"]
  ,['lmt',"({'1': el=>node=> el.push(asJML(node)), '3': el=>node=>el.push(node.data), string: x=> asJML(document.createElement('span').innerHTML=x), recur: frag=> asJML(frag)})",LOGIC], ['lmt',"'TODO: reduce deps: sort out the ist.string to typeof. fold into logic: compact that ist.string line into the lmt logic among whatever else.'", NOTES],['lmt',"(()=> {asJML=(frag)=> {let el = [frag.nodeName], attrs = {};if (frag.attributes) {[...frag.attributes].forEach((attr)=> attrs[attr.name]=attr.value); el.push(attrs)};[...frag.childNodes].forEach((node)=>includes(node.nodeType)([1,3])?LOGIC.lmt[node.nodeType](el)(node):x=>x) ;return el};parse=(frag)=> ist.string(frag)?LOGIC.lmt['string'](frag):LOGIC.lmt['recur'](frag);return parse })()"]
  ]
</script>

<script id='OPTICS'>
  OPTICS=
  [['lens',    	"get=>set=> ({get,set})"]
  ,['get',     	"l=>o=> within(l)('get')(o)"]
  ,['set',     	"l=>v=>o=> (within(l)('set')(v)(o),o)"]
  ,['over',    	"l=>f=>o=> (set(l)(f(get(l)(o)))(o),o)"]
  ,['getpath', 	"xs=>o=> flow(...map(get)(map(fov)(xs)))(o)"]
  ,['setpath',  "xs=>v=>o=> (set(fov(last(xs)))(v)(xs.length>1?getpath(slice(0,-1)(xs))(o):o),o)"]
  ,['sentry',	"(o,lens=fov)=>(z)=>(map(x=>set(lens(x[0]))(x[1])(z))(entries(o)),z)"]
  ,['gentry',	"(xs,lens=fov)=>(z)=>(reduce((a,x)=>(a[x]=get(lens(x))(z),a) ,{})(xs))"]
  ,['pusher',	"l=>v=>o=>over(l)(e=>[...e,v])(o)"]
  
  ,['focii',   	"(keys,lens=fov,ctx={})=>release(ctx)(fov)(keys)"]
  ,['fov',   	"(k,lens)=> assign({get:o=>within(o)(k),set:v=>o=>know_by(k,o)(v)},lens)"]
  ,['folk',		"(k,lens)=>({get:o=>getComputedStyle(o).getPropertyValue(k),set:v=>o=>o.style.setProperty(k,v)})"]
  ,['existsin',	"(inside)=>(...way)=>prop=>getpath(prop?way.concat(prop):way)(inside)"]
//DEPENDS ON CONF
  ,['getconf',	"(...way)=>getpath(way)(CONF)"]
  ,['setconf',	"(...way)=>v=>setpath(way)(v)(CONF)"]
  ]
</script>
<script id='TRANSDUCER'>
TRANSDUCER=
[['across',     'journey=>start=>initiates=> reduce(journey,start)(initiates)']
,['transduce',  'changes=>reducing=>seed=>members=> across(changes(reducing))(seed)(members)']
,['mapping',    'change=>reducing=>(wanted,seekers)=> reducing(wanted,change(seekers))' ]
,['filtering',  'question=>reducing=>(needels,hazestack)=> question(hazestack) ? reducing(needels,hazestack) : needels']
//paramorphism~mapping and filtering with access to accumulator; use size|length for index
,['minding',   'change=>reducing=>(wanted,seekers,i=0)=> reducing(wanted,change(seekers,wanted))']
,['finding',   'question=>reducing=>(needels,hazestack)=> question(hazestack,needels) ? reducing(needels,hazestack) : needels']
//TODO: when do these break|fail?
,['dropping', 'forsaken=>reducing=>(desire,item)=> --forsaken >= 0?desire:reducing(desire,item)']
,['taking',   'taken=>reducing=> (desire,item)=> --taken >= 0 ? reducing(desire, item):desire']
,['gating',     "gate=>(...keys)=>filtering(gate(...keys))"]
,['shovel',  '(hole,thing)=> (push(thing)(hole), hole)']
,['dropgate',   "skips=> x=> ifte( gte(0)( decr(skips) ) )(false)(true)"]
,['twogate',    "(open,close,opened=false)=>x=>open(x)?opened=true:close(x)?opened=false:opened"]
]
</script>
<script id='TENSOR'>
  TENSOR=
[['idmatrix',"n=>map((_,i,a)=> map((c2,i2)=> ifte(eq(i)(i2))(1)(0)) (a)) (fill(0)(Array(n)))"]
,['mXm',"a=>b=> map(x=> map(y=>dotX(x)(y))(T(b)))(a)"]
,['mXms',"([...ms])=> reduce((a,c)=>mXm(a)(c))(ms)"]
,['mulScalar',"s=>M=> map(map(x=>x*=s))(M)"] 
// ,['vecadd',"(v1=[0,0],v2=[0,0])=> zipWith(v1,v2,uncarry(add,2))"]
// ,['addvert',"twith((a,b)=>a+b,0)"]
,['dotX',"a=>b=> reduce(uncarry(add,2))(map((x,i)=> a[i]*b[i])(a))"]
,['T', "a=> map((_,i)=>map(y=>y[i])(a))(a[0])"]
]
</script>
<script id='DOMAIM'>
  DOMAIM=
  [['DOMTYPES',"map(a=>map(x=>a+x+'element')(split(',')([existsin(CONF.TYPES)(a)()].filter(Boolean))))(['html','svg'])"]
  ,['',"release(ist)(b=>a=>eq(b)(type(a)))(split(',')(DOMTYPES))"]
  ,['render',"(el,where='end')=>protocall(Element)('insertAdjacentElement')(({before:'beforebegin',after:'afterend',begin:'afterbegin',end:'beforeend'})[where],el)"]
  ,['surrender',"(el)=>(bag,before=getpath(['lastChild','nextSibling']))=>bag.insertBefore(el,before(bag))"]
  ,['sleepdom',"createDocumentFragment()"]
  ,['domo', "x=>el=> appendChild(tml(x)) (el)"]
  ,['omod',"x=>(appendChild(x)(sleepdom),lmt(x))"]
  ,['freeChild',"element=>removeChild(element)(element.parentNode)"]
  ,['freeChildren',"parent=>map(freeChild)(parent.childNodes)"]
  ,['emancipate',"(selector,f=freeChild)=>(x=qsa(selector),ist.array(x)?map(f)(x):f(x))"]
  ,['qsa', `sel=> { var arr = void 0;
    if (sel.charAt('0') === '#' && sel.indexOf(' ') < 0) { return document.getElementById(sel.replace('#', ''));} arr = [].slice.call(document.querySelectorAll(sel)); if (arr.length < 2) arr = arr[0]; return arr; }`]
  ,['nom',"(name)=> name+LOGIC.nom(name)"]
  ,['nom',"name=>(qsa(`[id*=${name}]`) ? (ist.array(qsa(`[id*=${name}]`)) ? size(qsa(`[id*=${name}]`)) : 1) : 0)",LOGIC]
]  



</script>
<script id='EVENTFUL'>
  EVENTFUL=
  [['eventSink' , `()=> ({
          sink: Object.create(null)
          , emit(event, data) { (this.sink[event]||[]).forEach((handler)=> handler(data)) }
          , on(event, handler) { if (!this.sink[event]) this.sink[event] = []; this.sink[event].push(handler) }
          , off(event, handler) { const i = (this.sink[event]||[]).findIndex((h)=> h === handler); if (i > -1) this.sink[event].splice(i, 1) }
          , clear(event) { this.sink[event]=[] }  })`]
  ,['timers',`({active: {}
      , make(f,t) {let newIntrvls=setInterval.apply(window,[f, t].concat([].slice.call(arguments,2))); this.active[newIntrvls] = {on:true,fn:f.toString()}; return newIntrvls }
      , clear(id) {timers.active[id].on=false;return clearInterval(id)}
      , clearAll() { forEach(id=>(clearInterval(id),timers.active[id].on=false))(keys(this.active))}})`]
  ,['EVE',"eventSink()"]
  ,['defer',"(fn, ...args) => setTimeout(fn, 1, ...args)"]
  ,['debounce',"(fn, ms = 0) => {let timeoutId; return function(...args) {clearTimeout(timeoutId); timeoutId = setTimeout(() => fn.apply(this, args), ms) }}"]
  ,['ineventof',"({})",CONF]
  ,['',"map((stimulus)=>document.addEventListener(stimulus,(setconf('ineventof',stimulus)(debounce(dat=>EVE.emit(stimulus,dat),15)) ,getconf('ineventof',stimulus))))(getOwnPropertyNames(window).filter(x=>x.match(/^on/)).map(replace(/on/,'')))"]
  ]
  // debounce = (fn, ms = 0) => {let timeoutId; return function(...args) {clearTimeout(timeoutId); timeoutId = setTimeout(() => fn.apply(this, args), ms) }}
  // delay = (fn, wait, ...args) => setTimeout(fn, wait, ...args)
  // sleep = ms => new Promise(resolve => setTimeout(resolve, ms))
</script>
<script id='OPTICS_DOM'>
  OPTICS_DOM=
  [['folk',"(k,lens)=>({get:o=>getComputedStyle(o).getPropertyValue(k),set:v=>o=>o.style.setProperty(k,v)})"]
  ,['gcs',"k=>o=>get(folk(k))(o)"]
  ,['scs',"k=>v=>o=>set(folk(k))(v)(o)"]
  ,['getdat',"k=>el=>getpath(['dataset',k])(el)"]
  ,['setdat',"k=>v=>el=>setpath(['dataset',k])(v)(el)"]
  ,['advise',"target=>dat=> flip(set(fov(ist.htmlinputelement(target)?'value':'textContent')))(target)(dat)"]
  ,['DARK',"()=>sentry({'--C_0':'black','--C_5':'white'},folk)(document.documentElement)"]
  ,['LIGHT',"()=>sentry({'--C_5':'black','--C_0':'white'},folk)(document.documentElement)"]
  ]
</script>


<script id='TENSOR_DOMIMATRIX'>
// DEPENDS ON TENSOR
  TENSOR_DOMIMATRIX=
	[['dims',"(arr)=>(c)=>arr.reduce((r,k,i)=>(i%c===0?r.push([k]):r[r.length-1].push(k))&&r,[])"]
	,['idm16',"()=>map(parseFloat)(split(',')(join(',')(T(idmatrix(4)))))"]
	,['mXm16',"(M1,M2)=>reduce((a,c)=>concat(c)(a))((mXm(dims(M1)(4))(dims(M2)(4))))"]
	,['csscolmaj',"m=> T(dims(m)(4))"]
	,['domgen',"([...ms])=> T(reduce((a,c)=>mXm(a)(c)) (map(m=>csscolmaj(m))(ms)))"]
	,['m6to16',"o=> ifte (size(o)>6) (o) (reduce((a,c,i)=>(a[c]=o[i],a),idm16())([0,1,4,5,12,13]))"]
	// ,['extract',`(s,delim=',')=> map(parseFloat)(split(delim)(replace(/^\\w*\\(|\\)/g,'')(s)[1]))`]
	,['extract',"s=>map(parseFloat)(split(',')(replace(getconf('RE','matrix3d'),'')(s)))"]
	,['m3d',"n=> `matrix3d(${join(',')(n)})`"]
	,['m2d',"M3d=> `matrix(${join(',')(map(i=>extract(M3d)[i])([0,1,4,5,12,13]))})`"]
	,['mod3dcss',"([...values])=> m3d(domgen(values))"]
	// d('mod2dcss') (([...values]) =>m2d(domgen(values)))
	,['mod',"([...values],d=0)=> ifte (!d) (m3d(domgen(values))) (m2d(m3d(domgen(values))))"]
	,['mvmt',"(el,d)=>(tfm)=> getComputedStyle(el).transform==='none' ? mod(tfm,d):mod((tfm).concat([m6to16(getComputedStyle(el).transform.match(/\\(([^\\)]+)\\)/)[1].split(','))]),d)"]
	// ,['mvmt',"(el,d)=>(tfm)=> getComputedStyle(el).transform==='none' ? mod(tfm,d):mod((tfm).concat([m6to16(extract(getComputedStyle(el))]),d)"]
	,['mv',"(tfm)=>(el,d)=>el.style.transform= mvmt(el,d)(tfm)"]
	,["TFM3D",`({perspective:d=> [1,0,0,0,0,1,0,0,0,0,0,-1/d,0,0,0,1]
	    ,scale:(w=1,h=w,d=w)=> [w,0,0,0,0,h,0,0,0,0,d,0,0,0,0,1]
	    ,translate:(x=0,y=0,z=0)=> [ 1,0,0,0,0,1,0,0,0,0,1,0,x,y,z,1]
	    ,rotate:{ x: a=> [1,0,0,0,0,cos(a),-sin(a),0,0,sin(a),cos(a),0,0,0,0,1]
	            , y: a=> [cos(a),0,sin(a),0,0,1,0,0,-sin(a),0,cos(a),0,0,0,0,1]
	            , z: a=> [cos(a),-sin(a),0,0,sin(a),cos(a),0,0,0,0,1,0,0,0,0,1] }})`]
	,['rot',"(angle=PI/2,axis='z')=> getpath(['rotate',axis])(TFM3D)(angle)"]
	,['tra',"(x=0,y=0,z=0)=> getpath(['translate'])(TFM3D)(x,y,z)"]
	,['sca',"(x=1,y=x,z=1)=> getpath(['scale'])(TFM3D)(x,y,z)"]
	,['around',"(an,ax)=>(x,y,z)=>[tra(x,y,z),rot(an,ax),tra(-x,-y,-z)]"]


	,['turn',"(x,s)=>(i,n=1)=> mv([rot(n*PI*2/i,s)])(x)"]
	,['nrut',"(x,s)=>(i,n=1)=> mv([rot(-n*PI*2/i,s)])(x)"]
	,['wheelzoom',"(f=mv([sca(1.1)]))=>(g=mv([sca(1/1.1)]))=>e=> e.deltaY>0? f(e.target) : g(e.target)"	]
	]


</script>

<script id='INSTORE'>
  INSTORE=
[['funsm',"({s,i,ns})=>(map(n=>i=s[i][n])(ns) ,i )"]
,['store', "(s={},is=[])=> ({state: ()=> s, xform: x=>o=> (s=x(s,o), is.map(i=>i(s)), s), watch: cb=> is.push(cb), watchers: is})"]
,['stock',"$tore=>prop=> $tore.xform((state,o)=>over(fov(prop))(o)(state))"]
,['stockpath',"$tore=>props=> $tore.xform((state,o)=>setpath(props)(o)(state))"]
// ,['restock',"$tore=>prop=> $tore.xform((state,o)=>over(fov(prop))(o)(state))"]
/* set up stores */
,['$',"store()"]
// foreach surface ct
]
// XX.watch(x=> console.log(x.mushroom))
</script>






<script id='#LOAD_SCRIPTS'>
  map(PACK=>funpack(world[PACK]))(
  map(x=>x.id)(filter(x=>x.id&&!x.id.includes('#'))(getElementsByTagName('script')))
)
</script>
</body>
</html>





